<!DOCTYPE html>
<html>
<body>
<style>
.button {
    background-color: #4CAF50; /* Green */
    border: none;
    color: white;
    padding: 16px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
}

.button1 {
    background-color: white; 
    color: black; 
    border: 2px solid #4CAF50;
}

.button1:hover {
    background-color: #4CAF50;
    color: white;
}

.button2 {
    background-color: white; 
    color: black; 
    border: 2px solid #008CBA;
}

.button2:hover {
    background-color: #008CBA;
    color: white;
}

.button3 {
    background-color: white; 
    color: black; 
    border: 2px solid #f44336;
}

.button3:hover {
    background-color: #f44336;
    color: white;
}

.button4 {
    background-color: white;
    color: black;
    border: 2px solid #e7e7e7;
}

.button4:hover {background-color: #e7e7e7;}

.button5 {
    background-color: white;
    color: black;
    border: 2px solid #555555;
}

.button5:hover {
    background-color: #555555;
    color: white;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="http://127.0.0.1:3001/socket.io/socket.io.js"></script>
<script>


	var socket = io('http://127.0.0.1:3001');
	socket.on('data', function(msg){
		changeWaterLevel(msg.level);
		changeValveRatio(msg.valve);
	});
	
	socket.on('command',function(msg){
		if(msg.title == 'start')
			startVis()	
		});
	
	const highLevelSensor = VAR-HIGHLEVELSENSOR 
	const lowLevelSensor = VAR-LOWLEVELSENSOR
	/*
	const tankHeight = VAR-TANKHEIGHT*100
	const tankRadius = VAR-TANKRADIUS*100
	const drainRadius = VAR-DRAINRADIUS*100
	const started = false
	*/
	function precisionRound(number, precision) {
	  var factor = Math.pow(10, precision);
	  return Math.round(number * factor) / factor;
	}
	
	function startVis(){
		var water6Element = document.getElementById("water_6");
		water6Element.setAttribute("style", "fill:rgb(135,206,235);stroke:purple;stroke-width:0;fill-opacity:1;visibility:visible");
	}

	var changeWaterLevel = function(level){
		var t = document.getElementById("water_3");
		var tt = document.getElementById("water_1");
		var ttt = document.getElementById("heightValue");
		var tttt = document.getElementById("water_4");
		tt.setAttribute("cy",(500-400*level));
		t.setAttribute("y",(500-400*level));
		t.setAttribute("height", 500-(500-400*level));
		ttt.innerHTML = 'Height: '+(precisionRound(level,2)*100)+'%'
		if((500-400*level)<440)
		{
			tttt.setAttribute("y", 440);
			tttt.setAttribute("height", 40);
		}
		else if((500-400*level)>440 && (500-400*level)<480 )
		{
			tttt.setAttribute("y", (500-400*level));
			tttt.setAttribute("height", 480-(500-400*level));
		}
		else if((500-400*level)>480)
		{
			tttt.setAttribute("y", 480);
			tttt.setAttribute("height", 0);
		}
	}

	var changeValveRatio = function(ratio){
		var water5Element = document.getElementById("water_5");
		var valveElement = document.getElementById("valve");
		var valveText = document.getElementById("valveValue");
		valveElement.setAttribute("rx", 20*(ratio));
		if(ratio == 0)
			valveElement.setAttribute("rx", 1);
		water5Element.setAttribute("y",40*(1-ratio)+440);
		water5Element.setAttribute("height",40*ratio);
		valveText.innerHTML = 'Valve: '+(ratio*100)+'%';
	}


	$(document).ready(function(){
		changeWaterLevel(0);
		changeValveRatio(0);
		var t = document.getElementById('high_sensor')
		t.setAttribute('transform','translate(0,'+((400*(1-highLevelSensor)))+')')
		var tt = document.getElementById('low_sensor')
		tt.setAttribute('transform','translate(0,'+((400*(1-lowLevelSensor)))+')')
		var ttt = document.getElementById('highValue')
		ttt.setAttribute('transform','translate(0,'+((400*(1-highLevelSensor))+7)+')')
		ttt.innerHTML = (highLevelSensor*100) + '%'
		var tttt = document.getElementById('lowValue')
		tttt.setAttribute('transform','translate(0,'+((400*(1-lowLevelSensor))+7)+')')
		tttt.innerHTML = (lowLevelSensor*100) + '%'
	});
</script>
<div style="border: 1px solid black;float: left;clear: none; ">
<div>
<!--
<button class="button button1">Pump </button>
<button class="button button1">Valve</button>
<button class="button button1">Start</button>
<button class="button button1">Stop</button>
<button class="button button1">Reset</button>
-->
</div>
<div>
<svg id="tank" height="600" width="500" >
	<g>
		<rect id="water_6" x="180" y="20" width="40" height="500" style="fill:rgb(135,206,235);stroke:purple;stroke-width:0;fill-opacity:1;visibility:hidden" />
		<ellipse id="water_2" cx="200" cy="500" rx="100" ry="20" style="fill:rgb(135,206,235);stroke:purple;stroke-width:0;fill-opacity:1" />
		<rect id="water_3" x="100" y="500" width="200" height="0" style="fill:rgb(135,206,235);stroke:purple;stroke-width:0;fill-opacity:1" />
		<rect id="water_4" x="300" y="440" width="50" height="40" style="fill:rgb(135,206,235);stroke:purple;stroke-width:0;fill-opacity:1" />
		<rect id="water_5" x="350" y="440" width="100" height="40" style="fill:rgb(135,206,235);stroke:purple;stroke-width:0;fill-opacity:1" />
		<ellipse id="water_1" cx="200" cy="500" rx="100" ry="20" style="fill:rgb(135,206,235);stroke:blue;stroke-width:1;fill-opacity:1" />
		
		<rect id="inlet_1" x="180" y="20" width="40" height="40" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		
		<ellipse id="inlet_3" cx="200" cy="60" rx="20" ry="4" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		
		<rect id="tank_1" x="100" y="100" width="200" height="400" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		<ellipse id="tank_2" cx="200" cy="100" rx="100" ry="20" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		<ellipse id="tank_3" cx="200" cy="500" rx="100" ry="20" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		
		<rect id="drain_1" x="300" y="440" width="100" height="40" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		<ellipse id="drain_2" cx="300" cy="460" rx="4" ry="20" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		<ellipse id="drain_3" cx="400" cy="460" rx="4" ry="20" style="fill:yellow;stroke:purple;stroke-width:1;fill-opacity:0.2" />
		<ellipse id="valve" cx="350" cy="460" rx="20" ry="20" style="fill:black;stroke:purple;stroke-width:0" />
		
		<polygon transform="translate(0,200)" id="high_sensor" points="310,110 300,100 310,90" style="fill:gray;stroke:purple;stroke-width:1"/>
		<polygon transform="translate(0,250)" id="low_sensor" points="310,110 300,100 310,90" style="fill:gray;stroke:purple;stroke-width:1" />
		
		<text id="valveValue" x="320" y="500" font-family="Verdana" font-size="20">Valve:0%</text>
		<text id="heightValue" x="320" y="50" font-family="Verdana" font-size="20">Height:0%</text>
		<text id="highValue" x="320" y="100" font-family="Verdana" font-size="20"></text>
		<text id="lowValue" x="320" y="100" font-family="Verdana" font-size="20"></text>
		
	</g>
	Sorry, your browser does not support inline SVG.  
</svg>
</div>

</div>
</body>

</html>
